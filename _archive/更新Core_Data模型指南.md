# 更新 Core Data 模型 - 添加「前手息」欄位

## 重要說明

已為公司債表單添加了以下功能：
- ✅ **申購金額** = 申購價格 × 持有面額（自動計算）
- ✅ 新增「**前手息**」欄位
- ✅ **交易金額** = 申購金額 + 前手息（自動計算）
- ✅ 對調損益資訊和配息資訊區域順序
- ✅ 配息月份改為選擇器（1月/7月、2月/8月...等選項）

## 需要手動更新 Core Data 模型

由於添加了新的「前手息」欄位，您需要在 Xcode 中更新 Core Data 模型：

### 步驟 1：打開 Core Data 模型

1. 在 Xcode 中打開專案
2. 在左側專案導航器中找到並點擊：
   ```
   InvestmentDashboard/DataModel.xcdatamodeld
   ```

### 步驟 2：選擇 CorporateBond 實體

1. 在中間面板的「ENTITIES」列表中，點擊選擇 **CorporateBond**
2. 確保右側的 Data Model Inspector 已顯示

### 步驟 3：添加新屬性

1. 在 **Attributes** 區域，點擊底部的「**+**」按鈕
2. 新屬性會出現，命名為 **previousHandInterest**
3. 在右側 Data Model Inspector 中設定：
   - **Name**: `previousHandInterest`
   - **Type**: `String`
   - **Optional**: 勾選 ✅

### 步驟 4：保存並編譯

1. 保存檔案（Command + S）
2. 清理專案（Command + Shift + K）
3. 重新編譯專案（Command + B）

## 驗證功能

編譯成功後，測試以下功能：

### 1. 測試自動計算

1. 打開 App，進入新增資產記錄
2. 切換到「公司債」分頁
3. 輸入：
   - **申購價**：例如 100
   - **持有面額**：例如 10000
4. 觀察「**申購金額**」應該自動顯示：1,000,000.00
5. 輸入「**前手息**」：例如 5000
6. 觀察「**交易金額**」應該自動顯示：1,005,000.00

### 2. 測試配息月份選擇器

1. 點擊「配息月份」欄位
2. 應該會彈出選單，包含以下選項：
   - 1月、7月
   - 2月、8月
   - 3月、9月
   - 4月、10月
   - 5月、11月
   - 6月、12月

### 3. 測試區域順序

確認公司債表單的區域順序為：
1. 基本資訊
2. 利率資訊
3. 申購資訊
4. **配息資訊**（已移到前面）
5. **損益資訊**（已移到後面）

## 欄位說明

### 申購資訊區域

| 欄位名稱 | 類型 | 說明 |
|---------|------|------|
| 申購價 | 輸入 | 手動輸入 |
| 持有面額 | 輸入 | 手動輸入 |
| **申購金額** | 自動 | = 申購價 × 持有面額 |
| 前手息 | 輸入 | 手動輸入（新增欄位） |
| **交易金額** | 自動 | = 申購金額 + 前手息 |

## 常見問題

### Q: 編譯時出現「Use of unresolved identifier 'previousHandInterest'」錯誤？

**A**: 這表示 Core Data 模型尚未更新。請確保：
1. 已在 DataModel.xcdatamodeld 中添加 `previousHandInterest` 屬性
2. 已保存模型檔案
3. 已清理並重新編譯專案

### Q: App 執行時閃退或出現 Core Data 錯誤？

**A**: 這可能是因為資料模型版本不匹配。解決方法：
1. 刪除 App 並重新安裝（會清空資料）
2. 或者創建新的 Core Data 模型版本（進階）

### Q: 計算結果不正確？

**A**: 確保輸入的是數字，不要包含特殊符號。系統會自動處理千分位格式。

## 完成

完成以上步驟後，公司債表單的所有新功能都應該正常運作！

如有任何問題，請檢查：
- Xcode Console 中的錯誤訊息
- 確保所有檔案都已正確加入 Xcode 專案
- 確保 Core Data 模型已更新並保存
