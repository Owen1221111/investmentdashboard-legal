# 訂閱策略說明

## 訂閱模式：選項 1 - 首次打開要求試用

### 用戶體驗流程

#### 首次使用
```
1. 用戶下載並打開 App
2. （如果是首次使用）顯示 Onboarding 教學
3. 延遲 1.5 秒後，自動顯示訂閱頁面
4. 用戶選擇：
   a. 點擊「開始免費試用」→ 啟動 30 天試用
   b. 點擊「關閉」→ 標記為已看過，不再顯示
```

#### 試用期中（1-30 天）
```
✅ 可使用所有功能
✅ 導航欄顯示金色皇冠圖標 + 剩餘天數
✅ 可隨時取消訂閱
✅ 資料自動同步到 iCloud
```

#### 試用期結束後
```
如果未訂閱：
  ❌ 無法新增客戶
  ❌ 無法新增月度資料
  ✅ 可以查看所有現有資料
  ✅ 資料完整保留（不會被刪除）
  ✅ 點擊「新增」按鈕會提示訂閱

如果訂閱成功：
  ✅ 恢復所有功能
  ✅ 繼續同步資料
  ✅ 每月自動續訂 NT$100
```

---

## 資料安全保證

### ☁️ 資料儲存位置
- **本地**：Core Data（設備儲存）
- **雲端**：iCloud / CloudKit（用戶的 Apple ID 帳號）

### 🔒 資料保護承諾
1. ✅ **資料永遠不會被刪除**
   - 無論是否訂閱，資料都保留在用戶的 iCloud

2. ✅ **訂閱狀態獨立**
   - 訂閱只控制功能存取權限
   - 不影響資料的儲存和保留

3. ✅ **隨時可恢復**
   - 用戶隨時訂閱都能立即恢復所有功能
   - 之前的資料完整可用

---

## 功能限制規則

### 試用期 / 已訂閱
| 功能 | 狀態 | 入口位置 |
|------|------|---------|
| 新增客戶 | ✅ 可用 | ContentView 右上角 + 按鈕 |
| 編輯客戶 | ✅ 可用 | 客戶詳情頁 |
| 刪除客戶 | ✅ 可用 | 客戶詳情頁 |
| 新增月度資料 | ✅ 可用 | ContentView 右上角 + 按鈕 |
| 編輯月度資料 | ✅ 可用 | 月度資料表格 |
| 新增公司債資料 | ✅ 可用 | 公司債明細表格 + 按鈕 |
| 新增結構型商品（進行中） | ✅ 可用 | 結構型明細表格 + 按鈕 |
| 新增結構型商品（已出場） | ✅ 可用 | 結構型已出場表格 + 按鈕 |
| 新增保險保單 | ✅ 可用 | 保險管理頁 + 按鈕 |
| 查看所有資料 | ✅ 可用 | 所有頁面 |
| iCloud 同步 | ✅ 啟用 | 自動同步 |
| OCR 辨識 | ✅ 可用 | 保險管理頁 |
| 保險試算 | ✅ 可用 | 保險計算器 |
| 圖表分析 | ✅ 可用 | 所有圖表 |

### 試用期結束 / 未訂閱
| 功能 | 狀態 | 限制說明 |
|------|------|---------|
| 新增客戶 | ❌ 需訂閱 | 點擊會提示訂閱 |
| 編輯客戶 | ✅ 可用 | 不受限制 |
| 刪除客戶 | ✅ 可用 | 不受限制 |
| 新增月度資料 | ❌ 需訂閱 | 點擊會提示訂閱 |
| 編輯月度資料 | ✅ 可用 | 不受限制 |
| 新增公司債資料 | ❌ 需訂閱 | 點擊會提示訂閱 |
| 新增結構型商品（進行中） | ❌ 需訂閱 | 點擊會提示訂閱 |
| 新增結構型商品（已出場） | ❌ 需訂閱 | 點擊會提示訂閱 |
| 新增保險保單 | ❌ 需訂閱 | 點擊會提示訂閱 |
| 查看所有資料 | ✅ 完全免費 | 不受限制 |
| iCloud 同步 | ✅ 持續運作 | 不受限制 |
| OCR 辨識 | ✅ 可用 | 不受限制 |
| 保險試算 | ✅ 可用 | 不受限制 |
| 圖表分析 | ✅ 可用 | 不受限制 |

### 限制邏輯
```swift
// 所有新增資料功能的檢查點
if !subscriptionManager.canAccessPremiumFeatures() {
    // 顯示訂閱頁面
    showingSubscription = true
} else {
    // 執行新增功能
}
```

### 已實作的功能鎖定位置
1. **ContentView.swift** (第93行、第115行)
   - 新增客戶按鈕
   - 新增月度資料按鈕

2. **CorporateBondsDetailView.swift** (第174行)
   - 公司債明細表格新增按鈕

3. **StructuredProductsDetailView.swift** (第377行、第577行)
   - 結構型明細表格新增按鈕（進行中）
   - 結構型已出場表格新增按鈕

4. **InsurancePolicyView.swift** (第338行、第1916行、第1939行)
   - 保險管理頁頂部新增保單按鈕（手動新增表單）
   - 保險明細表格相機按鈕（OCR 辨識新增）
   - 保險明細表格綠色+按鈕（直接新增空白行）

---

## 用戶場景範例

### 場景 A：積極用戶
```
第 1 天：下載 App，啟動試用，添加 5 個客戶
第 15 天：繼續使用，添加更多資料
第 30 天：試用結束前，決定訂閱 NT$100/月
結果：✅ 持續使用所有功能
```

### 場景 B：猶豫用戶
```
第 1 天：下載 App，啟動試用，添加 2 個客戶
第 30 天：試用結束，不訂閱
第 35 天：想添加新客戶，發現需要訂閱
第 40 天：決定訂閱
結果：✅ 之前的 2 個客戶和所有資料都還在
       ✅ 訂閱後立即可新增客戶
```

### 場景 C：只想查看
```
第 1 天：下載 App，點擊「關閉」（不啟動試用）
第 2 天：使用 App，但無法新增客戶/資料
結果：⚠️ 可以查看演示，但無法實際使用
      💡 隨時可點擊皇冠圖標啟動試用
```

### 場景 D：取消後重訂
```
第 1 天：啟動試用，使用 30 天
第 31 天：訂閱自動開始，使用 3 個月
第 121 天：取消訂閱
第 150 天：想重新使用，決定訂閱
結果：✅ 所有歷史資料完整保留
       ✅ 訂閱後立即恢復功能
```

---

## 技術實作

### SubscriptionManager 核心方法

```swift
// 檢查是否需要顯示首次訂閱提示
func shouldShowSubscriptionPrompt() -> Bool

// 標記用戶已看過提示
func markSubscriptionPromptAsSeen()

// 檢查是否可存取進階功能
func canAccessPremiumFeatures() -> Bool

// 取得試用期剩餘天數
func remainingTrialDays() -> Int?
```

### UserDefaults 追蹤
```swift
private let hasSeenPromptKey = "hasSeenSubscriptionPrompt"
```

### 流程整合位置
- `InvestmentDashboardApp.swift`：App 啟動時檢查訂閱
- `ContentView.swift`：首次啟動顯示訂閱提示、功能限制檢查
- `SubscriptionView.swift`：訂閱界面、標記已看過
- `SubscriptionManager.swift`：訂閱邏輯管理

---

## App Store 描述建議

### 標題
**專業理財顧問的客戶管理工具 - 免費試用 30 天**

### 副標題
**iCloud 同步 | OCR 辨識 | 智能提醒**

### 功能亮點
- 💼 無限客戶管理
- 📊 完整資產追蹤（股票、債券、保險、定存）
- 📱 OCR 智能辨識保單資料
- ☁️ iCloud 跨設備同步
- 🔔 到期提醒不遺漏
- 📈 視覺化圖表分析

### 訂閱資訊
- 💰 每月 NT$100
- 🎁 首月免費試用
- 🔄 隨時取消
- ✅ 資料永久保留

---

## 常見問題 FAQ

**Q: 試用期結束後會失去資料嗎？**
A: 不會！所有資料都儲存在您的 iCloud 帳號，永遠不會被刪除。訂閱只影響新增功能，查看資料完全免費。

**Q: 如果我不訂閱可以做什麼？**
A: 您可以查看、編輯、刪除現有的所有資料，但無法新增新客戶或新月度資料。

**Q: 重新訂閱後資料會回來嗎？**
A: 會的！資料一直都在您的 iCloud 中，訂閱後立即恢復所有功能。

**Q: 可以隨時取消訂閱嗎？**
A: 可以！在 iOS 設定 > [您的名稱] > 訂閱項目中隨時取消，不會有任何懲罰。

**Q: 首次打開一定要訂閱嗎？**
A: 不用！您可以點擊「關閉」，之後隨時點擊皇冠圖標啟動試用。

---

© 2025 Owen Liu
