# 📙 部署上架指南

> **合併自：** 上架準備清單.md、App_Store_審核問題修正指南.md、網頁部署指南.md、訂閱功能配置指南.md、訂閱策略說明.md
> **最後更新：** 2025-11-18

---

## 📋 目錄

1. [App Store 上架準備](#1-app-store-上架準備)
2. [App Store 審核常見問題](#2-app-store-審核常見問題)
3. [訂閱功能設定](#3-訂閱功能設定)
4. [網頁部署（隱私政策、使用條款）](#4-網頁部署)
5. [版本更新流程](#5-版本更新流程)

---

## 1. App Store 上架準備

### 1.1 上架前檢查清單

#### ✅ App 基本資訊
- [ ] App 名稱確認
- [ ] Bundle ID 正確：`com.owen.InvestmentDashboard`
- [ ] 版本號設定完成
- [ ] Team ID 設定：`V43868D94M`

#### ✅ 建置設定
- [ ] Clean Build Folder（Cmd + Shift + K）
- [ ] 選擇「Any iOS Device (arm64)」
- [ ] Product → Archive 成功
- [ ] 無編譯錯誤和警告

#### ✅ 版本號
- [ ] MARKETING_VERSION 正確（例如：1.0.1）
- [ ] CURRENT_PROJECT_VERSION 遞增（例如：3）
- [ ] 版本號高於已上架版本

**檢查方式：**
```bash
cd /path/to/InvestmentDashboard
grep -E "MARKETING_VERSION|CURRENT_PROJECT_VERSION" InvestmentDashboard.xcodeproj/project.pbxproj
```

---

### 1.2 App Store Connect 設定

#### 建立 App（首次上架）
1. 登入 https://appstoreconnect.apple.com
2. 點擊「我的 App」→「+」→「新增 App」
3. 填寫資訊：
   - **平台：** iOS
   - **名稱：** InvestmentDashboard（或中文名稱）
   - **主要語言：** 繁體中文
   - **Bundle ID：** com.owen.InvestmentDashboard
   - **SKU：** com.owen.InvestmentDashboard（或自訂）

#### 準備截圖
**必備尺寸：**
- **6.5" Display（iPhone 14 Pro Max）：** 1290 x 2796 px（需要 3-10 張）
- **12.9" Display（iPad Pro）：** 2048 x 2732 px（需要 3-10 張）

**建議截圖內容：**
1. 主畫面（客戶列表）
2. 月度資產明細表
3. 保險管理畫面
4. 試算表計算器
5. 圖表展示

**截圖工具：**
- 使用 Simulator → Cmd + S 截圖
- 或使用 Screenshot 工具

#### 填寫 App 資訊
- **分類：** 財務（Finance）→ 個人理財（Personal Finance）
- **描述：** 詳細說明 App 功能（最多 4000 字元）
- **關鍵字：** 投資, 理財, 客戶管理, 保險, 貸款（最多 100 字元）
- **支援網址：** 您的官網或 GitHub
- **行銷網址：** （選填）
- **隱私政策網址：** **必填！**（見第 4 章）

---

### 1.3 隱私權設定

#### App 隱私權問卷
在 App Store Connect 必須填寫：

**資料類型：**
1. **聯絡資訊**
   - ☑️ 電子郵件地址（客戶Email）
   - 用途：App 功能、分析

2. **財務資訊**
   - ☑️ 購買記錄（訂閱）
   - ☑️ 其他財務資訊（投資資產）
   - 用途：App 功能

3. **使用者內容**
   - ☑️ 相片或影片（保單照片）
   - 用途：App 功能

**重要聲明：**
- ✅ 資料用於提供 App 功能
- ✅ 資料透過 iCloud 同步
- ❌ 資料不會用於追蹤
- ❌ 資料不會分享給第三方

---

### 1.4 建置與上傳

#### 步驟 1：Archive
1. Xcode → Product → Clean Build Folder
2. 選擇「Any iOS Device (arm64)」
3. Product → Archive
4. 等待建置完成

#### 步驟 2：Distribute App
1. Organizer 自動開啟
2. 選擇最新的 Archive
3. 點擊「Distribute App」
4. 選擇「App Store Connect」
5. 選擇「Upload」
6. 確認設定：
   - ☑️ Include bitcode（選填）
   - ☑️ Upload symbols
7. 點擊「Upload」

#### 步驟 3：等待處理
- 上傳後等待 5-30 分鐘
- 會收到郵件通知「建置已準備好提交」

---

### 1.5 提交審核

1. **選擇建置版本**
   - 在 App Store Connect 選擇剛上傳的建置
   - 確認版本號正確

2. **填寫版本資訊**
   - **此版本的新增功能：**
     - 首次上架：列出所有主要功能
     - 更新版本：說明更新內容

3. **送出以供審查**
   - 確認所有資訊正確
   - 點擊右上角「送出以供審查」
   - 等待審核（通常 1-3 天）

---

## 2. App Store 審核常見問題

### 2.1 審核被拒原因與解決方案

#### 拒絕原因 1：缺少隱私政策
**錯誤訊息：**
```
Guideline 5.1.1 - Legal - Privacy - Data Collection and Storage
We noticed that your app requires users to register or log in to access features,
but you have not provided privacy policy.
```

**解決方法：**
1. 部署隱私政策網頁（見第 4 章）
2. 在 App Store Connect 填寫隱私政策網址
3. 重新提交審核

---

#### 拒絕原因 2：功能不完整
**錯誤訊息：**
```
Guideline 2.1 - Performance - App Completeness
We found that your app crashed on launch.
```

**解決方法：**
1. 在多台裝置測試（iPhone、iPad）
2. 測試不同 iOS 版本
3. 修復崩潰問題
4. 提供測試帳號（如需登入）

---

#### 拒絕原因 3：缺少使用說明
**錯誤訊息：**
```
Guideline 2.3.7 - Performance
Your app lacks clear instructions on how to use it.
```

**解決方法：**
1. 加入首次使用教學（`OnboardingView`）
2. 提供使用說明（App 內或網頁）
3. 在審核備註說明操作流程

---

#### 拒絕原因 4：訂閱功能問題
**錯誤訊息：**
```
Guideline 3.1.2 - Business - Payments - Subscriptions
Your app's subscription does not meet the requirements.
```

**解決方法：**
1. 確保訂閱功能可正常使用
2. 提供清楚的訂閱條款
3. 可讓使用者取消訂閱
4. 提供價格說明

---

### 2.2 版本號錯誤

#### 錯誤：版本號過低
**錯誤訊息：**
```
Invalid Pre-Release Train. The train version '1.0' is closed for new build submissions.
CFBundleShortVersionString [1.0] must be higher than [1.0].
```

**解決方法：**
```bash
# 更新版本號
cd /path/to/InvestmentDashboard

# 方法 1：手動編輯 project.pbxproj
# 找到並修改：
MARKETING_VERSION = 1.0.1;  # 從 1.0 改為 1.0.1
CURRENT_PROJECT_VERSION = 3;  # 遞增建置號碼

# 方法 2：使用 agvtool（需先設定）
agvtool new-marketing-version 1.0.1
agvtool next-version -all
```

**重新建置：**
1. Clean Build Folder
2. Archive
3. Upload

---

### 2.3 審核加速技巧

#### 提供詳細資訊
在「審核備註」填寫：
```
測試帳號：demo@example.com
測試密碼：Demo12345

主要功能：
1. 客戶管理 - 新增/編輯/刪除客戶
2. 月度資產追蹤 - 記錄投資組合
3. 保險管理 - OCR 辨識保單
4. 試算表計算器 - 計算 IRR

測試步驟：
1. 點擊左上角漢堡按鈕
2. 點擊「+」新增客戶
3. 選擇客戶後可管理投資資料
```

#### 回應審核問題
如果收到審核團隊的問題：
1. **快速回應**（24 小時內）
2. **提供詳細說明**
3. **附上截圖或影片**
4. **禮貌專業**

---

## 3. 訂閱功能設定

### 3.1 StoreKit 配置

#### 建立 StoreKit Configuration 檔案
已完成：`Configuration.storekit`

**檔案內容：**
- 訂閱群組
- 訂閱方案
- 價格設定

#### 設定訂閱方案
```json
{
  "identifier": "com.owen.premium.monthly",
  "type": "auto-renewable",
  "duration": "P1M",
  "price": "$4.99"
}
```

---

### 3.2 App Store Connect 訂閱設定

#### 步驟 1：建立訂閱群組
1. App Store Connect → 您的 App
2. 功能 → App 內購買
3. 訂閱群組 → 建立訂閱群組
4. 命名：「Premium」

#### 步驟 2：新增訂閱
1. 點擊「+」新增訂閱
2. 填寫資訊：
   - **參考名稱：** Premium Monthly
   - **產品 ID：** com.owen.premium.monthly
   - **訂閱期間：** 1 個月
   - **價格：** $4.99（或 NT$150）

#### 步驟 3：本地化描述
填寫訂閱說明（繁體中文）：
```
訂閱名稱：進階會員（月繳）
訂閱說明：
• 無限客戶數量
• OCR 保單辨識
• 試算表計算器
• 進階圖表分析
• 優先客服支援
```

---

### 3.3 訂閱策略

#### 定價建議
**月繳方案：**
- 💵 基礎：NT$150 / US$4.99
- 💰 進階：NT$300 / US$9.99

**年繳方案：**
- 💵 基礎：NT$1,500 / US$49.99（省 2 個月）
- 💰 進階：NT$3,000 / US$99.99（省 3 個月）

#### 免費試用
**建議設定：**
- 首次訂閱享 7 天免費試用
- 試用期間可隨時取消

**配置：**
```
訂閱 → 免費試用期間 → 7 天
```

---

### 3.4 程式碼整合

#### SubscriptionManager.swift
已實作訂閱管理器，包含：
```swift
// 檢查訂閱狀態
SubscriptionManager.shared.isSubscribed

// 購買訂閱
SubscriptionManager.shared.purchase(productID: "com.owen.premium.monthly")

// 恢復購買
SubscriptionManager.shared.restore()
```

#### 本地測試
1. Xcode → Scheme → Edit Scheme
2. Run → Options
3. StoreKit Configuration → 選擇 `Configuration.storekit`
4. 執行 App 測試訂閱流程

---

## 4. 網頁部署

### 4.1 隱私政策與使用條款網頁

#### 需要部署的檔案
```
法律文件/
├── Privacy_Policy.md（英文）
├── 隱私權政策.md（中文）
├── Terms_of_Service.md（英文）
└── 使用條款.md（中文）
```

#### 轉換為 HTML
**方法 1：使用 Markdown 轉換工具**
```bash
# 安裝 Pandoc
brew install pandoc

# 轉換
pandoc 隱私權政策.md -o privacy.html
pandoc 使用條款.md -o terms.html
```

**方法 2：使用網頁範本**
創建簡單的 HTML 範本：
```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>隱私權政策 - InvestmentDashboard</title>
    <style>
        body {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            font-family: -apple-system, sans-serif;
            line-height: 1.6;
        }
        h1 { color: #007AFF; }
    </style>
</head>
<body>
    <!-- 將 Markdown 內容貼在這裡 -->
</body>
</html>
```

---

### 4.2 部署到 GitHub Pages

#### 步驟 1：建立 Repository
1. 前往 GitHub
2. 新增 Repository：`InvestmentDashboard-Legal`
3. 設為 Public

#### 步驟 2：上傳檔案
```bash
cd 網頁檔案/
git init
git add privacy.html terms.html
git commit -m "Add legal documents"
git branch -M main
git remote add origin https://github.com/yourusername/InvestmentDashboard-Legal.git
git push -u origin main
```

#### 步驟 3：啟用 GitHub Pages
1. Repository → Settings → Pages
2. Source → main branch
3. Save
4. 網址：`https://yourusername.github.io/InvestmentDashboard-Legal/privacy.html`

---

### 4.3 其他部署選項

#### Netlify（推薦）
1. 前往 https://netlify.com
2. 拖曳資料夾上傳
3. 自動部署並獲得網址

#### Vercel
1. 前往 https://vercel.com
2. Import Git Repository
3. 自動部署

#### 自有主機
- 上傳到您的網站伺服器
- 確保可透過 HTTPS 存取

---

### 4.4 在 App Store Connect 填寫網址

1. App Store Connect → 您的 App
2. App 資訊
3. **隱私政策 URL：** 填入部署後的網址
4. 儲存

**範例：**
```
https://yourusername.github.io/InvestmentDashboard-Legal/privacy.html
```

---

## 5. 版本更新流程

### 5.1 準備更新版本

#### 更新版本號
```bash
# 檢查當前版本
grep MARKETING_VERSION project.pbxproj

# 更新（例如 1.0.1 → 1.0.2）
# 手動編輯 project.pbxproj：
MARKETING_VERSION = 1.0.2;
CURRENT_PROJECT_VERSION = 4;  # 建置號碼+1
```

#### 填寫更新說明
在 App Store Connect 的「此版本的新增功能」：

**範例（錯誤修正）：**
```
版本 1.0.1 更新內容：

• 修正貸款功能的顯示問題
• 改善 OCR 辨識準確度
• 提升 App 穩定性

感謝您的支持！如有問題請聯絡我們。
```

**範例（新功能）：**
```
版本 1.1.0 新功能：

🎉 全新功能
• 新增貸款管理功能
• 支援利率調整記錄
• 新增投資概覽圖表

✨ 改進
• 優化介面設計
• 提升同步速度
• 改善使用體驗
```

---

### 5.2 TestFlight 測試（選用）

#### 內部測試
1. App Store Connect → TestFlight
2. 新增內部測試人員
3. 上傳建置後自動推送

#### 外部測試
1. 建立外部測試群組
2. 新增測試人員（Email）
3. 提交 Beta 審核（快速，約 1 天）
4. 審核通過後推送給測試人員

---

### 5.3 更新版本上架

#### 建立新版本
1. App Store Connect → 您的 App
2. 「+ 版本或平台」
3. 輸入新版本號（例如：1.0.2）
4. 選擇建置
5. 填寫更新說明
6. 送出審核

#### 審核通過後
- **自動發布：** 審核通過立即上架
- **手動發布：** 審核通過後您決定何時發布

---

## 📊 審核時間統計

**平均審核時間：**
- 🚀 快速：12-24 小時（40%）
- ⏱️ 正常：1-3 天（50%）
- 🐢 較慢：3-7 天（10%）

**加速技巧：**
1. 提供詳細的審核備註
2. 準備清晰的測試帳號
3. 快速回應審核團隊問題
4. 避免重大功能變更

---

## 📞 需要協助？

### 聯絡 Apple 審核團隊
- App Store Connect → 解決中心
- 回覆審核訊息
- 申請加急審核（特殊情況）

### 常見資源
- Apple Developer 論壇
- App Store Connect 說明
- WWDC 影片

---

## 📚 相關文件

- 📚 [主索引](📚_主索引_README.md) - 查找所有功能
- 📘 [開發維護指南](📘_開發維護指南.md) - 技術實作
- 📗 [功能使用手冊](📗_功能使用手冊.md) - 功能說明

---

**🎉 祝您上架順利！**
